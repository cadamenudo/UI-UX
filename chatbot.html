<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chatbot ‚Äì Cada Menudo</title>
<link rel="stylesheet" href="https://cadamenudo.github.io/UI-UX/css-fonts.css"/>

<style>
  :root{
    --primary:#3956E8; --secondary:#7459D9; --accent:#E8C239;
    --bg:#ffffff; --text:#0d1320; --muted:#6b7280; --border:#E6E8F0; --shadow:0 8px 28px rgba(15,23,42,.12);
    --bot:#F3F6FF; --user:#F7F8FB;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:"Greycliff CF",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

  /* Bot√≥n flotante */
  .chat-launcher{
    position:fixed; right:20px; bottom:20px; width:64px; height:64px; border-radius:50%;
    border:none; background:var(--primary); color:#fff; display:grid; place-items:center;
    box-shadow:var(--shadow); cursor:pointer; z-index:9999;
  }
  .launcher-logo{
    width:38px; height:38px; border-radius:50%; background:#fff; padding:6px; object-fit:contain;
  }

  /* Ventana */
  .chat-window{
    position:fixed; right:20px; bottom:92px; width:360px; max-width:92vw; height:560px; max-height:78vh;
    display:none; grid-template-rows:auto auto auto 1fr auto auto;
    background:#fff; border-radius:18px; overflow:hidden; box-shadow:var(--shadow); z-index:9999; border:1px solid var(--border);
  }

  /* Header */
  .chat-header{ display:flex; align-items:center; gap:12px; padding:12px 14px; background:#fff; border-bottom:1px solid var(--border) }
  .bot-logo{ width:32px; height:32px; border-radius:50%; background:#fff; padding:4px; object-fit:contain }
  .chat-title{font-weight:700; color:var(--primary);}
  .header-actions{margin-left:auto}
  .icon-btn{ background:transparent; border:none; color:#94A3B8; font-size:18px; cursor:pointer; padding:6px }

  /* Input arriba */
  .input-top{ padding:10px 12px; border-bottom:1px solid var(--border); background:#fff }
  .input-row{ display:flex; gap:8px }
  .input-row input{ flex:1; padding:12px; border:1px solid var(--border); border-radius:12px; font-size:14px; outline:none; }
  .input-row input::placeholder{ color:#98A2B3; }
  .input-row button{ padding:12px 14px; border:none; border-radius:12px; background:var(--primary); color:#fff; font-weight:700; cursor:pointer }

  /* Cuerpo */
  .chat-body{padding:14px; overflow:auto; background:#fff}
  .msg{display:flex; margin:8px 0}
  .msg.bot{justify-content:flex-start}
  .msg.user{justify-content:flex-end}
  .bubble{ max-width:78%; padding:10px 12px; border-radius:14px; font-size:14px; line-height:1.35; border:1px solid var(--border) }
  .msg.bot .bubble{background:var(--bot)}
  .msg.user .bubble{background:var(--user)}
  .meta{display:block; color:#9AA4B2; font-size:11px; margin-top:4px}

  /* Botones de temas y acorde√≥n */
  .topic-grid{ display:flex; flex-wrap:wrap; gap:8px; margin-top:4px; }
  .topic-btn{ border:1px solid var(--border); background:#fff; color:#374151; padding:8px 12px; border-radius:999px; font-size:12px; cursor:pointer; }
  .cat-panel{ border:1px dashed var(--border); background:#fff; border-radius:12px; padding:10px; }
  .cat-title{ font-weight:700; color:#3956E8; margin-bottom:6px; }
  .q-list{ display:flex; flex-direction:column; gap:6px; }
  .q-item{ border:1px solid var(--border); border-radius:10px; background:#fff; }
  .q-btn{ width:100%; text-align:left; background:#fff; border:none; cursor:pointer; padding:10px 12px; font-size:14px; color:#0d1320; border-radius:10px; }
  .q-btn:hover{ background:#F7F8FB; }
  .ans{ display:none; border-top:1px solid var(--border); }
  .ans.open{ display:block; }
  .ans-inner{ padding:10px 12px; font-size:14px; background:#F9FAFB; border-radius:0 0 10px 10px; }

  /* Toolbar visible */
  .toolbar{
    display:flex;
    justify-content:center;
    gap:10px;
    padding:10px 12px;
    border-top:1px dashed var(--border);
    background:#fff;
  }
  .tool{font-size:12px; color:#374151; cursor:pointer; border:1px solid var(--border); padding:6px 10px; border-radius:8px; background:#fff}

  /* Footer */
  .chat-footer{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 12px; border-top:1px solid var(--border); background:#fff }
  .privacy-link{ font-size:12px; color:#8A93A6; text-decoration:none }
  .privacy-link:hover{ color:#6B7280; text-decoration:underline }

</style>
</head>
<body>

<button class="chat-launcher" id="launcher" aria-label="Abrir chat">
  <img class="launcher-logo" src="https://cadamenudo.github.io/UI-UX/isotopo%20blue%20w-name.png" alt="Cada Menudo"/>
</button>

<section class="chat-window" id="chatWindow" aria-live="polite">
  <header class="chat-header">
    <img class="bot-logo" src="https://cadamenudo.github.io/UI-UX/isotopo%20blue%20w-name.png" alt="Cada Menudo"/>
    <div><div class="chat-title">ChinChin Bot</div></div>
    <div class="header-actions"><button id="closeBtn" class="icon-btn" aria-label="Cerrar">‚úï</button></div>
  </header>

  <div class="input-top">
    <div class="input-row">
      <input id="userInput" type="text" placeholder="Pregunta" autocomplete="off"/>
      <button id="sendBtn" type="button">Enviar</button>
    </div>
  </div>

  <main class="chat-body" id="chatBody"></main>

  <div class="toolbar" id="toolbar">
    <button class="tool" id="clearBtn">üßπ Limpiar</button>
    <button class="tool" id="emailBtn">üìß Soporte</button>
  </div>

  <footer class="chat-footer">
    <a class="privacy-link" href="/privacidad.html" target="_blank" rel="noopener">Privacidad</a>
    <div style="font-size:12px; color:#8A93A6;">Cada Menudo</div>
  </footer>
</section>

<script>
(function(){
  const els = {};
  const STORAGE_KEY = 'cm_chat_history_v3';
  const byId = id => document.getElementById(id);
  const escapeHtml = s => { const d=document.createElement('div'); d.textContent=s; return d.innerHTML; };

  window.addEventListener('DOMContentLoaded', init);

  async function init(){
    Object.assign(els, {
      launcher: byId('launcher'), chat: byId('chatWindow'), body: byId('chatBody'),
      input: byId('userInput'), send: byId('sendBtn'), close: byId('closeBtn'),
      clear: byId('clearBtn'), email: byId('emailBtn')
    });

    els.launcher.addEventListener('click', ()=>{ toggle(true); setTimeout(()=>els.input.focus(),50); });
    els.close.addEventListener('click', ()=>toggle(false));
    els.send.addEventListener('click', onSend);
    els.input.addEventListener('keydown', e=>{ if(e.key==='Enter') onSend(); });
    els.clear.addEventListener('click', clearChat);
    els.email.addEventListener('click', ()=> window.location.href = buildSupportEmail());

    pushHTML('bot','üëã Hola, soy <b>Chin Chin</b>, tu chatbot de Cada Menudo. Preg√∫ntame algo o escribe <b>‚Äúlimpiar‚Äù</b> para reiniciar el chat.');
  }

  function toggle(open){ els.chat.style.display=open?'grid':'none'; }

  function push(role,text){ renderMsg(role,text,false,false); }
  function pushHTML(role,html){ renderMsg(role,html,false,true); }

  function renderMsg(role,text,skip,isHTML){
    const wrap=document.createElement('div'); wrap.className='msg '+role;
    const b=document.createElement('div'); b.className='bubble';
    if(isHTML) b.innerHTML=text; else b.innerHTML=escapeHtml(text).replace(/\n/g,'<br/>');
    const meta=document.createElement('span'); meta.className='meta';
    meta.textContent=(role==='bot'?'Asistente':'T√∫')+' ‚Ä¢ '+new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    b.appendChild(meta); wrap.appendChild(b); els.body.appendChild(wrap);
    if(!skip) els.body.scrollTop = els.body.scrollHeight;
  }

  function onSend(){
    const text=(els.input.value||'').trim(); if(!text) return;
    push('user', text); els.input.value='';

    // üßπ Comando limpiar
    if (/^(limpiar|borrar|reiniciar|reset)$/i.test(text)) { clearChat(); return; }

    // üìß Comando email
    if (/^(email|correo|soporte|contacto)$/i.test(text)) {
      window.location.href = buildSupportEmail();
      push('bot','Abriendo correo para soporte t√©cnico... ‚úâÔ∏è');
      return;
    }

    push('bot','No encontr√© esa pregunta. Escribe "soporte" si necesitas ayuda por correo.');
  }

  function clearChat(){
    els.body.innerHTML='';
    pushHTML('bot','Conversaci√≥n limpiada. ¬øEn qu√© te ayudo ahora?');
  }

  function buildSupportEmail(){
    const body=`Hola equipo t√©cnico,%0D%0A%0D%0ANecesito ayuda con el chatbot de Cada Menudo.%0D%0A%0D%0ADescripci√≥n del problema:%0D%0A(Escribe aqu√≠‚Ä¶)%0D%0A%0D%0A---%0D%0AEnviado desde el chatbot de Cada Menudo.`;
    return `mailto:tech@cadamenudo.com?subject=Soporte%20Chatbot%20Cada%20Menudo&body=${body}`;
  }
})();
</script>
</body>
</html>
