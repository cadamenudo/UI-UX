<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Recordatorios ‚Äî Cada Menudo</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --cm-primary:#3956E8; --cm-secondary:#7459D9; --cm-accent:#E8C239;
  --cm-bg:#f7f8fa; --cm-text:#111; --cm-muted:#64748B; --cm-border:#e5e7eb;
  --radius:16px;
}
*{box-sizing:border-box}
body{font-family:'Nunito',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; margin:0; background:var(--cm-bg); color:var(--cm-text)}
.header{position:sticky; top:0; z-index:20; background:#fff; border-bottom:1px solid var(--cm-border); padding:14px 16px; display:flex; gap:10px; align-items:center; justify-content:space-between}
.header h1{margin:0; font-size:1.1rem}
.btn{background:var(--cm-primary); color:#fff; border:none; border-radius:999px; padding:.7rem 1rem; font-weight:700; cursor:pointer; box-shadow:0 6px 18px rgba(57,86,232,.25)}
.btn-outline{background:#fff; color:var(--cm-primary); border:2px solid var(--cm-primary)}
.container{max-width:820px; margin:10px auto; padding:0 12px 80px}
.section{margin:18px 0}
.section h2{margin:8px 4px 10px; font-size:.95rem; color:#334155}
.card{background:#fff; border:1px solid var(--cm-border); border-radius:14px; padding:12px; display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0; box-shadow:0 4px 14px rgba(2,6,23,.04)}
.left{display:flex; align-items:flex-start; gap:12px}
.dot{width:14px; height:14px; border-radius:999px; background:var(--cm-secondary); margin-top:6px; flex:0 0 auto}
.meta{font-size:.85rem; color:var(--cm-muted)}
.title{font-weight:800}
.badges{display:flex; gap:6px; flex-wrap:wrap; margin-top:4px}
.badge{font-size:.75rem; padding:.15rem .5rem; border-radius:999px; border:1px solid var(--cm-border); color:#334155; background:#f9fafb}
.actions{display:flex; gap:6px}
.iconbtn{border:1px solid var(--cm-border); background:#fff; padding:.45rem .6rem; border-radius:10px; cursor:pointer}
.iconbtn.danger{border-color:#fecaca; color:#b91c1c}
.empty{background:#fff; border:1px dashed var(--cm-border); padding:22px; border-radius:14px; text-align:center; color:#var(--cm-muted)}
.toast{position:fixed; right:16px; bottom:86px; background:#111; color:#fff; padding:.8rem 1rem; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.25); opacity:0; transform:translateY(12px); pointer-events:none}
.toast.show{opacity:1; transform:translateY(0); transition:opacity .2s, transform .2s}

/* ===== Modal ===== */
.overlay{position:fixed; inset:0; background:rgba(17,24,39,.48); display:none; z-index:9998}
.overlay.show{display:block}
.modal{position:fixed; inset:0; display:grid; place-items:center; z-index:9999; padding:16px; pointer-events:none}
.modal.show{pointer-events:auto}
.sheet{width:min(720px,100%); background:#fff; border-radius:var(--radius);
  box-shadow:0 24px 80px rgba(2,6,23,.30); overflow:hidden; transform:translateY(12px); opacity:0;
  transition:transform .2s ease, opacity .2s ease;}
.modal.show .sheet{transform:translateY(0); opacity:1}
.hdr{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 18px; border-bottom:1px solid var(--cm-border)}
.hdr h3{margin:0; font-size:1.05rem}
.body{padding:16px 18px}
.grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
@media (max-width:720px){ .grid{grid-template-columns:1fr} }
.field{display:flex; flex-direction:column; gap:6px}
label{font-size:.9rem; color:var(--cm-muted); font-weight:700}
input[type="text"], input[type="date"], input[type="time"], select, textarea{
  width:100%; border:1px solid var(--cm-border); border-radius:12px; padding:.7rem .85rem; font:inherit; background:#fff;
}
textarea{min-height:90px}
.days{display:flex; gap:6px; flex-wrap:wrap}
.day{width:36px; height:36px; display:grid; place-items:center; border:1px solid var(--cm-border); border-radius:10px; cursor:pointer; user-select:none; font-weight:700; color:#var(--cm-muted); background:#fff}
.day[aria-pressed="true"]{background:var(--cm-primary); color:#fff; border-color:var(--cm-primary)}
.ft{display:flex; gap:10px; justify-content:flex-end; align-items:center; padding:12px 14px; border-top:1px solid var(--cm-border); background:#fff}
.btn-ghost{background:transparent; border:none; color:var(--cm-muted); cursor:pointer}
.req{color:#ef4444}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h1>Recordatorios</h1>
  <button class="btn" id="btn-new">+ Nuevo</button>
</div>

<!-- Content -->
<div class="container" id="list"></div>

<!-- Empty state -->
<template id="tpl-empty">
  <div class="empty">
    <p><strong>Sin recordatorios</strong></p>
    <p>Presiona ‚ÄúNuevo‚Äù para crear tu primer reminder.</p>
  </div>
</template>

<!-- Item template -->
<template id="tpl-item">
  <div class="card" data-id="">
    <div class="left">
      <div class="dot" aria-hidden="true"></div>
      <div>
        <div class="title"></div>
        <div class="meta"></div>
        <div class="badges"></div>
      </div>
    </div>
    <div class="actions">
      <button class="iconbtn" data-act="edit" title="Editar">‚úé</button>
      <button class="iconbtn danger" data-act="delete" title="Eliminar">üóë</button>
    </div>
  </div>
</template>

<!-- Section template -->
<template id="tpl-section">
  <div class="section" data-group="">
    <h2></h2>
    <div class="items"></div>
  </div>
</template>

<!-- Toast -->
<div class="toast" id="toast" role="status" aria-live="polite">Hecho ‚úÖ</div>

<!-- ===== Modal (crear/editar) ===== -->
<div class="overlay" id="ovl" hidden></div>
<div class="modal" id="mdl" role="dialog" aria-modal="true" aria-labelledby="ttl" hidden>
  <div class="sheet" role="document">
    <div class="hdr">
      <h3 id="ttl">Nuevo recordatorio</h3>
      <button class="btn-ghost" id="x" aria-label="Cerrar">‚úï</button>
    </div>
    <form class="body" id="frm">
      <input type="hidden" name="id" id="rem-id"/>
      <div class="grid">
        <div class="field">
          <label for="name">T√≠tulo <span class="req">*</span></label>
          <input id="name" name="name" type="text" required placeholder="Ej: Pagar tarjeta / Revisi√≥n presupuesto">
        </div>
        <div class="field">
          <label for="type">Tipo</label>
          <select id="type" name="type">
            <option value="custom">Personalizado</option>
            <option value="bill">Pago de factura</option>
            <option value="budget">Revisi√≥n de presupuesto</option>
            <option value="goal">Aporte a meta</option>
          </select>
        </div>
        <div class="field">
          <label for="date">Fecha <span class="req">*</span></label>
          <input id="date" name="date" type="date" required>
        </div>
        <div class="field">
          <label for="time">Hora <span class="req">*</span></label>
          <input id="time" name="time" type="time" required>
        </div>
        <div class="field">
          <label for="recur">Recurrencia</label>
          <select id="recur" name="recur">
            <option value="once">Una vez</option>
            <option value="daily">Diario</option>
            <option value="weekly">Semanal</option>
            <option value="monthly">Mensual</option>
            <option value="custom">Custom (elige d√≠as)</option>
          </select>
        </div>
        <div class="field" id="row-days" style="display:none">
          <label>D√≠as (si Custom)</label>
          <div class="days">
            <button type="button" class="day" data-day="MO" aria-pressed="false">L</button>
            <button type="button" class="day" data-day="TU" aria-pressed="false">M</button>
            <button type="button" class="day" data-day="WE" aria-pressed="false">X</button>
            <button type="button" class="day" data-day="TH" aria-pressed="false">J</button>
            <button type="button" class="day" data-day="FR" aria-pressed="false">V</button>
            <button type="button" class="day" data-day="SA" aria-pressed="false">S</button>
            <button type="button" class="day" data-day="SU" aria-pressed="false">D</button>
          </div>
        </div>
        <div class="field" style="grid-column:1/-1">
          <label for="notes">Notas</label>
          <textarea id="notes" name="notes" placeholder="Detalle opcional‚Ä¶"></textarea>
        </div>
      </div>
    </form>
    <div class="ft">
      <button class="btn-outline" id="btn-cancel" type="button">Cancelar</button>
      <button class="btn" id="btn-save">Guardar</button>
    </div>
  </div>
</div>

<script>
/* ===== Utilities ===== */
const $ = (s, r=document)=>r.querySelector(s);
const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
const toast = $('#toast');
function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2000); }
function pad(n){ return String(n).padStart(2,'0'); }
function isoLocalDate(d){ const z= new Date(d); z.setMinutes(z.getMinutes()-z.getTimezoneOffset()); return z.toISOString().slice(0,10); }
function tomorrowISO(){ const d= new Date(); d.setDate(d.getDate()+1); return isoLocalDate(d); }
function parseDT(dateISO, timeHM){ const [h,m]=timeHM.split(':').map(Number); const d=new Date(dateISO); d.setHours(h||0,m||0,0,0); return d; }
function fmtTime(hm){const [h,m]=hm.split(':').map(Number); const d=new Date(); d.setHours(h,m); return d.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});}

/* ===== Storage (demo) ===== */
const KEY='cm.reminders.v1';
function loadAll(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch{ return [] } }
function saveAll(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
function upsert(item){
  const list=loadAll();
  if(item.id){ const i=list.findIndex(x=>x.id===item.id); if(i>-1) list[i]=item; else list.push(item); }
  else { item.id = crypto.randomUUID(); list.push(item); }
  saveAll(list); return item;
}
function removeById(id){ const list=loadAll().filter(x=>x.id!==id); saveAll(list); }

/* ===== Render list ===== */
const listEl = $('#list');
const tplSection = $('#tpl-section');
const tplItem = $('#tpl-item');
const SECTION_ORDER = ['today','tomorrow','upcoming','past'];
const SECTION_LABELS = {today:'Hoy', tomorrow:'Ma√±ana', upcoming:'Pr√≥ximos', past:'Pasados'};
function groupKey(item){
  const now = new Date();
  const d = parseDT(item.date, item.time);
  const t0 = new Date(); t0.setHours(0,0,0,0);
  const t1 = new Date(); t1.setHours(24,0,0,0);
  const t2 = new Date(); t2.setHours(48,0,0,0);
  if(d>=t0 && d<t1) return 'today';
  if(d>=t1 && d<t2) return 'tomorrow';
  if(d>=now) return 'upcoming';
  return 'past';
}
function recurBadge(item){
  const map={once:'Una vez', daily:'Diario', weekly:'Semanal', monthly:'Mensual', custom:'Custom'};
  let s=map[item.recur]||'';
  if(item.recur==='custom' && item.days?.length){ s+=' ('+item.days.join(',')+')'; }
  return s;
}
function typeBadge(t){ const map={custom:'Personal', bill:'Factura', budget:'Presupuesto', goal:'Meta'}; return map[t]||t; }

function render(){
  listEl.innerHTML='';
  const items = loadAll()
    .sort((a,b)=> parseDT(a.date,a.time) - parseDT(b.date,b.time));

  if(items.length===0){ listEl.appendChild($('#tpl-empty').content.cloneNode(true)); return; }

  const groups = {};
  for(const it of items){
    const g = groupKey(it);
    (groups[g] ||= []).push(it);
  }
  for(const key of SECTION_ORDER){
    const arr = groups[key];
    if(!arr || arr.length===0) continue;
    const sec = tplSection.content.firstElementChild.cloneNode(true);
    sec.dataset.group = key;
    sec.querySelector('h2').textContent = SECTION_LABELS[key];
    const holder = sec.querySelector('.items');
    for(const it of arr){
      const node = tplItem.content.firstElementChild.cloneNode(true);
      node.dataset.id = it.id;
      node.querySelector('.title').textContent = it.name;
      node.querySelector('.meta').textContent = `${new Date(it.date).toLocaleDateString()} ‚Ä¢ ${fmtTime(it.time)}`;
      const badges = node.querySelector('.badges');
      const b1 = document.createElement('span'); b1.className='badge'; b1.textContent = typeBadge(it.type); badges.appendChild(b1);
      const b2 = document.createElement('span'); b2.className='badge'; b2.textContent = recurBadge(it); badges.appendChild(b2);
      node.querySelector('[data-act="edit"]').addEventListener('click', ()=> editItem(it.id));
      node.querySelector('[data-act="delete"]').addEventListener('click', ()=> delItem(it.id));
      holder.appendChild(node);
    }
    listEl.appendChild(sec);
  }
}

/* ===== CRUD UI ===== */
document.getElementById('btn-new').addEventListener('click', ()=> openModal());

function editItem(id){
  const it = loadAll().find(x=>x.id===id);
  if(!it) return;
  openModal(it);
}
function delItem(id){
  if(confirm('¬øEliminar este recordatorio?')){ removeById(id); render(); showToast('Eliminado'); }
}

/* ===== Modal logic ===== */
const ovl = $('#ovl'), mdl=$('#mdl'), frm=$('#frm');
const rowDays = $('#row-days'), recur = $('#recur');
function openModal(data){
  frm.reset();
  $('#ttl').textContent = data?.id ? 'Editar recordatorio' : 'Nuevo recordatorio';
  $('#rem-id').value = data?.id || '';
  $('#name').value   = data?.name || '';
  $('#type').value   = data?.type || 'custom';
  const now = new Date();
  const defDate = isoLocalDate(now);
  const defTime = pad(now.getHours())+':'+pad(Math.max(0, now.getMinutes()+5));
  $('#date').value   = data?.date || defDate;
  $('#time').value   = data?.time || defTime;
  $('#notes').value  = data?.notes || '';
  recur.value = data?.recur || 'once';
  rowDays.style.display = recur.value==='custom' ? '' : 'none';
  $$('.day').forEach(d=>d.setAttribute('aria-pressed', data?.days?.includes(d.dataset.day) ? 'true':'false'));

  ovl.hidden=false; ovl.classList.add('show');
  mdl.hidden=false; mdl.classList.add('show');
  setTimeout(()=>$('#name').focus(), 20);
}
function closeModal(){
  ovl.classList.remove('show'); mdl.classList.remove('show');
  setTimeout(()=>{ ovl.hidden=true; mdl.hidden=true; }, 150);
}
$('#x').addEventListener('click', closeModal);
$('#btn-cancel').addEventListener('click', closeModal);
ovl.addEventListener('click', closeModal);
document.addEventListener('keydown', e=>{ if(e.key==='Escape' && !mdl.hidden) closeModal(); });

recur.addEventListener('change', ()=> rowDays.style.display = recur.value==='custom' ? '' : 'none');
$$('.day').forEach(btn=> btn.addEventListener('click', ()=> {
  const on = btn.getAttribute('aria-pressed')==='true';
  btn.setAttribute('aria-pressed', String(!on));
}));

$('#btn-save').addEventListener('click', (e)=>{
  e.preventDefault();
  if(!frm.reportValidity()){
    showToast('Completa los campos requeridos ‚ö†Ô∏è'); return;
  }
  const days = $$('.day[aria-pressed="true"]').map(b=>b.dataset.day);
  if(recur.value==='custom' && days.length===0){ showToast('Elige 1+ d√≠as para Custom ‚ö†Ô∏è'); return; }
  const item = {
    id: $('#rem-id').value || undefined,
    name: $('#name').value.trim(),
    type: $('#type').value,
    date: $('#date').value,
    time: $('#time').value,
    recur: $('#recur').value,
    days,
    notes: $('#notes').value.trim()
  };
  upsert(item);
  render();
  closeModal();
  showToast('Guardado ‚úÖ');
});

/* ===== Seed demo (solo primera carga) ===== */
(function seed(){
  if(loadAll().length) { render(); return; }
  const demo=[
    {name:'Pagar escuela', type:'bill', date: tomorrowISO(), time:'06:00', recur:'monthly', days:[], notes:''},
    {name:'IBKR meeting', type:'custom', date: tomorrowISO(), time:'14:00', recur:'weekly', days:['WE'], notes:'Zoom link‚Ä¶'},
    {name:'Savings app meeting', type:'custom', date: isoLocalDate(new Date(Date.now()+3*86400000)), time:'13:30', recur:'weekly', days:['FR'], notes:''},
  ];
  demo.forEach(d=>upsert(d));
  render();
})();
</script>
</body>
</html>
