<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Presupuesto móvil – Cada Menudo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Nunito -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
  body {
    font-family: Nunito, sans-serif;
    background: #F6F7FF;
    padding: 16px;
    margin: 0;
  }

  /* HEADER */
  .top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  h1 {
    font-size: 1.4rem;
    font-weight: 800;
    margin: 0;
  }

  .toggle {
    background: white;
    border-radius: 999px;
    padding: 4px;
    display: flex;
    gap: 4px;
    border: 1px solid #E5E7EB;
  }

  .toggle span {
    padding: 6px 14px;
    border-radius: 999px;
    cursor: pointer;
    font-size: 0.85rem;
  }

  .toggle .active {
    background: #E8ECFF;
    color: #3956E8;
    font-weight: 700;
  }

  .select-month {
    background: white;
    padding: 8px 14px;
    border-radius: 10px;
    border: 1px solid #E5E7EB;
    font-size: 0.9rem;
    margin-bottom: 14px;
    margin-top: 4px;
    width: 100%;
  }

  /* SECCIONES PRESUPUESTO (ACORDEÓN) */
  .section {
    background: white;
    padding: 10px 14px;
    border-radius: 14px;
    margin-bottom: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .section.ingresos {
    border-left: 4px solid #22C55E;
  }
  .section.gastos {
    border-left: 4px solid #F97316;
  }
  .section.ahorro {
    border-left: 4px solid #3B82F6;
  }

  .section-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }

  .section-header {
    font-weight: 700;
    font-size: 1rem;
  }

  .section-label {
    font-size: 0.8rem;
    color: #64748B;
    margin-top: 2px;
  }

  .accordion-right {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .section-summary {
    font-size: 0.8rem;
    color: #64748B;
  }

  .accordion-icon {
    font-size: 0.9rem;
    transition: transform 0.2s ease;
  }

  .section.collapsed .accordion-icon {
    transform: rotate(-90deg);
  }

  .section-body {
    margin-top: 6px;
  }

  .section.collapsed .section-body {
    display: none;
  }

  .add-btn-small {
    border: none;
    background: #EEF2FF;
    color: #3956E8;
    font-size: 0.8rem;
    padding: 5px 10px;
    border-radius: 999px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 4px;
  }

  .row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    font-size: 0.95rem;
  }

  .row span:last-child {
    font-weight: 600;
  }

  /* TOTALES */
  .totals {
    margin-top: 4px;
    background: white;
    padding: 12px 14px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    margin-bottom: 12px;
  }

  .totals .row {
    font-weight: 600;
  }

  .totals .row span:first-child {
    color: #64748B;
    font-weight: 500;
  }

  .save {
    margin-top: 8px;
    width: 100%;
    padding: 14px;
    background: #7459D9;
    color: white;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    border: none;
    cursor: pointer;
  }

  /* CARD BASE */
  .card {
    background: white;
    padding: 14px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 14px;
  }

  /* COMPARATIVO */
  .comp-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .comp-title {
    font-weight: 800;
    font-size: 1rem;
  }

  .chips {
    display: flex;
    gap: 6px;
  }

  .chip {
    border-radius: 999px;
    border: 1px solid #E5E7EB;
    padding: 4px 10px;
    font-size: 0.8rem;
    cursor: pointer;
    background: #FFFFFF;
    color: #64748B;
  }

  .chip.active {
    border-color: #3956E8;
    background: #E8ECFF;
    color: #3956E8;
    font-weight: 700;
  }

  /* BANNER ESTADO */
  .status-banner {
    border-radius: 12px;
    padding: 8px 10px;
    font-size: 0.85rem;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .status-banner.green {
    background: #ECFDF3;
    color: #15803D;
  }
  .status-banner.yellow {
    background: #FEF9C3;
    color: #92400E;
  }
  .status-banner.red {
    background: #FEF2F2;
    color: #B91C1C;
  }

  .status-banner strong {
    font-weight: 800;
  }

  /* MINI RESUMEN */
  .mini-summary {
    margin-bottom: 8px;
  }

  .mini-summary .row {
    font-size: 0.9rem;
  }

  .mini-summary .row span:first-child {
    color: #64748B;
  }

  #barComp {
    width: 100%;
    height: 260px;
    margin-top: 4px;
    margin-bottom: 8px;
  }

  canvas {
    max-height: 260px;
    display: block;
  }

  /* DESVIACIONES TOP */
  .top-deviations {
    border-top: 1px dashed #E5E7EB;
    padding-top: 6px;
    margin-top: 4px;
    font-size: 0.85rem;
  }

  .top-dev-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
  }

  .top-dev-left {
    display: flex;
    flex-direction: column;
  }

  .top-dev-name {
    font-weight: 600;
  }

  .top-dev-detail {
    color: #64748B;
    font-size: 0.8rem;
  }

  .top-dev-diff.positive {
    color: #B91C1C;
    font-weight: 700;
  }
  .top-dev-diff.negative {
    color: #15803D;
    font-weight: 700;
  }

  /* MODAL AÑADIR */
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }

  .modal.open {
    display: flex;
  }

  .modal-content {
    background: #fff;
    border-radius: 16px;
    padding: 1.5rem 1.6rem;
    width: 90%;
    max-width: 380px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.25);
  }

  .modal-content h2 {
    margin-top: 0;
    font-size: 1.1rem;
    color: #111827;
    font-weight: 800;
    margin-bottom: 1rem;
  }

  .modal-content label {
    display: block;
    font-weight: 600;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
    margin-top: 0.4rem;
    color: #111827;
  }

  .modal-content input,
  .modal-content select,
  .modal-content textarea {
    width: 100%;
    padding: 0.7rem 0.8rem;
    border: 1px solid #D1D5DB;
    border-radius: 12px;
    font-size: 0.9rem;
    font-family: inherit;
    box-sizing: border-box;
    margin-bottom: 0.3rem;
  }

  .modal-content textarea {
    resize: vertical;
    min-height: 60px;
  }

  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 0.8rem;
  }

  .btn-cancel {
    border: none;
    background: #F3F4F6;
    color: #111827;
    padding: 0.6rem 1.1rem;
    border-radius: 10px;
    font-size: 0.85rem;
    cursor: pointer;
  }

  .btn-save {
    border: none;
    background: #3956E8;
    color: white;
    padding: 0.6rem 1.3rem;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 700;
    cursor: pointer;
  }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="top">
    <h1>Presupuesto</h1>
    <div class="toggle" id="toggleTipo">
      <span data-tipo="mensual" class="active">Mensual</span>
      <span data-tipo="anual">Anual</span>
    </div>
  </div>

  <select class="select-month" id="selectMonth">
    <option>Enero 2025</option>
    <option>Febrero 2025</option>
    <option>Marzo 2025</option>
  </select>

  <!-- SECCION INGRESOS (ACORDEÓN) -->
  <section class="section ingresos">
    <div class="section-header-row accordion-header" data-area="ingresos">
      <div>
        <div class="section-header">Ingresos</div>
        <div class="section-label">Lo que entra cada periodo</div>
      </div>
      <div class="accordion-right">
        <span class="section-summary" id="resumenIngresos">$0.00</span>
        <span class="accordion-icon">⌄</span>
      </div>
    </div>
    <div class="section-body">
      <button class="add-btn-small" data-area="ingresos">
        + Añadir
      </button>
      <div id="listaIngresos"></div>
    </div>
  </section>

  <!-- SECCION GASTOS (ACORDEÓN) -->
  <section class="section gastos collapsed">
    <div class="section-header-row accordion-header" data-area="gastos">
      <div>
        <div class="section-header">Gastos</div>
        <div class="section-label">Lo que sale en el periodo</div>
      </div>
      <div class="accordion-right">
        <span class="section-summary" id="resumenGastos">$0.00</span>
        <span class="accordion-icon">⌄</span>
      </div>
    </div>
    <div class="section-body">
      <button class="add-btn-small" data-area="gastos">
        + Añadir
      </button>
      <div id="listaGastos"></div>
    </div>
  </section>

  <!-- SECCION AHORRO (ACORDEÓN) -->
  <section class="section ahorro collapsed">
    <div class="section-header-row accordion-header" data-area="ahorro">
      <div>
        <div class="section-header">Ahorro</div>
        <div class="section-label">Lo que apartas del ingreso</div>
      </div>
      <div class="accordion-right">
        <span class="section-summary" id="resumenAhorro">$0.00</span>
        <span class="accordion-icon">⌄</span>
      </div>
    </div>
    <div class="section-body">
      <button class="add-btn-small" data-area="ahorro">
        + Añadir
      </button>
      <div id="listaAhorro"></div>
    </div>
  </section>

  <!-- TOTALES -->
  <section class="totals">
    <div class="row">
      <span>Total ingresos</span>
      <span id="totalIngresos">$0.00</span>
    </div>
    <div class="row">
      <span>Total gastos</span>
      <span id="totalGastos">$0.00</span>
    </div>
    <div class="row">
      <span>Total ahorro</span>
      <span id="totalAhorro">$0.00</span>
    </div>
    <div class="row">
      <span>Disponible</span>
      <span id="totalDisponible">$0.00</span>
    </div>
  </section>

  <button class="save">Guardar presupuesto</button>

  <!-- COMPARATIVO -->
  <section class="card">
    <div class="comp-header">
      <div class="comp-title">Comparar presupuesto vs real</div>
      <div class="chips" id="chipsArea">
        <button class="chip active" data-area="ingresos">Ingresos</button>
        <button class="chip" data-area="gastos">Gastos</button>
        <button class="chip" data-area="ahorro">Ahorro</button>
      </div>
    </div>

    <div id="statusBanner" class="status-banner green">
      <span><strong>Vas bien.</strong> Por debajo del presupuesto.</span>
      <span id="bannerPct">90%</span>
    </div>

    <div class="mini-summary">
      <div class="row">
        <span>Presupuesto</span>
        <span id="miniPres">$0.00</span>
      </div>
      <div class="row">
        <span>Real</span>
        <span id="miniReal">$0.00</span>
      </div>
      <div class="row">
        <span>Diferencia</span>
        <span id="miniDiff">$0.00</span>
      </div>
    </div>

    <canvas id="barComp"></canvas>

    <div class="top-deviations" id="topDeviations"></div>
  </section>

  <!-- MODAL AÑADIR -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h2 id="modalTitle">Añadir</h2>

      <label for="modalCategoria">Categoría</label>
      <select id="modalCategoria"></select>

      <label for="modalMonto">Monto</label>
      <input type="number" id="modalMonto" placeholder="0.00" />

      <label for="modalNota">Nota (opcional)</label>
      <textarea id="modalNota" placeholder="Ej. Detalle rápido..."></textarea>

      <div class="modal-actions">
        <button class="btn-cancel" id="btnCancel">Cancelar</button>
        <button class="btn-save" id="btnSave">Guardar</button>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // DATOS DEMO (BASE MENSUAL)
    // -----------------------------
    const demoData = {
      tipo: "mensual", // "mensual" o "anual"
      presupuesto: {
        ingresos: [
          { categoria: "Salario fijo", monto: 3200 },
          { categoria: "Ingreso extra", monto: 500 },
          { categoria: "Intereses / dividendos", monto: 150 }
        ],
        gastos: [
          { categoria: "Casa", monto: 1200 },
          { categoria: "Alimentación", monto: 650 },
          { categoria: "Transportación", monto: 220 },
          { categoria: "Entretenimiento", monto: 150 },
          { categoria: "Deuda", monto: 300 }
        ],
        ahorro: [
          { categoria: "Emergencia", monto: 250 },
          { categoria: "Meta específica", monto: 200 }
        ]
      },
      real: {
        ingresos: [
          { categoria: "Salario fijo", monto: 3300 },
          { categoria: "Ingreso extra", monto: 450 },
          { categoria: "Intereses / dividendos", monto: 120 }
        ],
        gastos: [
          { categoria: "Casa", monto: 1250 },
          { categoria: "Alimentación", monto: 780 },
          { categoria: "Transportación", monto: 250 },
          { categoria: "Entretenimiento", monto: 190 },
          { categoria: "Deuda", monto: 360 }
        ],
        ahorro: [
          { categoria: "Emergencia", monto: 180 },
          { categoria: "Meta específica", monto: 150 }
        ]
      }
    };

    // Opciones de categorías (mismas que desktop)
    const opcionesCategorias = {
      ingresos: [
        "Salario fijo",
        "Pago por hora",
        "Bono",
        "Comisión",
        "Negocio propio",
        "Propina",
        "Ingresos pasivos",
        "Intereses / dividendos"
      ],
      gastos: [
        "Casa",
        "Alimentación",
        "Impuestos",
        "Transportación",
        "Seguros",
        "Regalos y donaciones",
        "Gastos Médicos",
        "Cuidado Personal",
        "Dependientes",
        "Deuda",
        "Entretenimiento",
        "Telecomunicaciones"
      ],
      ahorro: [
        "Emergencia",
        "Meta específica",
        "Inversión",
        "Retiro",
        "Ahorro personal",
        "Ahorro para hijos",
        "Otros"
      ]
    };

    let tipoActual = "mensual"; // mensual/anual
    let areaComparativa = "ingresos"; // ingresos/gastos/ahorro
    let chartComp = null;

    function factorTipo() {
      return tipoActual === "anual" ? 12 : 1;
    }

    function formatear(monto) {
      return "$" + monto.toLocaleString("es-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function sumarLista(lista) {
      const f = factorTipo();
      return lista.reduce((acc, item) => acc + item.monto * f, 0);
    }

    function renderSecciones() {
      const f = factorTipo();

      const listaIngresos = document.getElementById("listaIngresos");
      const listaGastos = document.getElementById("listaGastos");
      const listaAhorro = document.getElementById("listaAhorro");

      listaIngresos.innerHTML = "";
      listaGastos.innerHTML = "";
      listaAhorro.innerHTML = "";

      demoData.presupuesto.ingresos.forEach(item => {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `<span>${item.categoria}</span><span>${formatear(item.monto * f)}</span>`;
        listaIngresos.appendChild(row);
      });

      demoData.presupuesto.gastos.forEach(item => {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `<span>${item.categoria}</span><span>${formatear(item.monto * f)}</span>`;
        listaGastos.appendChild(row);
      });

      demoData.presupuesto.ahorro.forEach(item => {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `<span>${item.categoria}</span><span>${formatear(item.monto * f)}</span>`;
        listaAhorro.appendChild(row);
      });

      document.getElementById("resumenIngresos").textContent = formatear(sumarLista(demoData.presupuesto.ingresos));
      document.getElementById("resumenGastos").textContent = formatear(sumarLista(demoData.presupuesto.gastos));
      document.getElementById("resumenAhorro").textContent = formatear(sumarLista(demoData.presupuesto.ahorro));
    }

    function renderTotales() {
      const tIng = sumarLista(demoData.presupuesto.ingresos);
      const tGas = sumarLista(demoData.presupuesto.gastos);
      const tAh = sumarLista(demoData.presupuesto.ahorro);
      const disp = tIng - tGas - tAh;

      document.getElementById("totalIngresos").textContent = formatear(tIng);
      document.getElementById("totalGastos").textContent = formatear(tGas);
      document.getElementById("totalAhorro").textContent = formatear(tAh);
      document.getElementById("totalDisponible").textContent = formatear(disp);
    }

    function actualizarBanner(pres, real) {
      const banner = document.getElementById("statusBanner");
      const pctSpan = document.getElementById("bannerPct");

      banner.classList.remove("green", "yellow", "red");

      if (!pres || pres === 0) {
        banner.classList.add("yellow");
        banner.innerHTML = `<span>Sin presupuesto para esta área.</span><span></span>`;
        return;
      }

      const ratio = real / pres;
      const pct = Math.round(ratio * 100);
      pctSpan.textContent = pct + "%";

      let texto = "";

      if (ratio < 0.9) {
        banner.classList.add("green");
        texto = "<strong>Vas bien.</strong> Por debajo del presupuesto.";
      } else if (ratio <= 1.05) {
        banner.classList.add("yellow");
        texto = "<strong>Casi al límite.</strong> Ojo con los gastos.";
      } else {
        banner.classList.add("red");
        texto = "<strong>Te pasaste.</strong> Sobre el presupuesto.";
      }

      banner.firstElementChild.innerHTML = texto;
    }

    function renderTopDeviations() {
      const cont = document.getElementById("topDeviations");
      cont.innerHTML = "";

      if (areaComparativa !== "gastos") {
        cont.style.display = "none";
        return;
      }

      const f = factorTipo();
      cont.style.display = "block";

      const mapaPres = {};
      demoData.presupuesto.gastos.forEach(g => {
        mapaPres[g.categoria] = (mapaPres[g.categoria] || 0) + g.monto * f;
      });

      const mapaReal = {};
      demoData.real.gastos.forEach(g => {
        mapaReal[g.categoria] = (mapaReal[g.categoria] || 0) + g.monto * f;
      });

      const categorias = new Set([
        ...Object.keys(mapaPres),
        ...Object.keys(mapaReal)
      ]);

      const desviaciones = [];
      categorias.forEach(cat => {
        const pres = mapaPres[cat] || 0;
        const real = mapaReal[cat] || 0;
        const diff = real - pres;
        if (Math.abs(diff) > 0) {
          desviaciones.push({ cat, pres, real, diff });
        }
      });

      desviaciones.sort((a, b) => Math.abs(b.diff) - Math.abs(a.diff));

      const top = desviaciones.slice(0, 3);

      if (top.length === 0) {
        cont.innerHTML = "<div class='top-dev-detail'>Sin desviaciones relevantes.</div>";
        return;
      }

      top.forEach(item => {
        const row = document.createElement("div");
        row.className = "top-dev-item";

        const left = document.createElement("div");
        left.className = "top-dev-left";
        left.innerHTML = `
          <span class="top-dev-name">${item.cat}</span>
          <span class="top-dev-detail">Pres: ${formatear(item.pres)} · Real: ${formatear(item.real)}</span>
        `;

        const diffSpan = document.createElement("span");
        diffSpan.className = "top-dev-diff " + (item.diff > 0 ? "positive" : "negative");
        const signo = item.diff > 0 ? "+" : "";
        diffSpan.textContent = signo + formatear(item.diff);

        row.appendChild(left);
        row.appendChild(diffSpan);
        cont.appendChild(row);
      });
    }

    function renderComparativo() {
      const f = factorTipo();

      const presLista = demoData.presupuesto[areaComparativa];
      const realLista = demoData.real[areaComparativa];

      const totalPres = sumarLista(presLista);
      const totalReal = realLista.reduce((acc, item) => acc + item.monto * f, 0);
      const diff = totalReal - totalPres;

      document.getElementById("miniPres").textContent = formatear(totalPres);
      document.getElementById("miniReal").textContent = formatear(totalReal);
      const diffSpan = document.getElementById("miniDiff");
      diffSpan.textContent = (diff >= 0 ? "+" : "") + formatear(diff);

      actualizarBanner(totalPres, totalReal);

      const ctx = document.getElementById("barComp").getContext("2d");
      if (chartComp) chartComp.destroy();

      chartComp = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Presupuesto", "Real"],
          datasets: [
            {
              label: areaComparativa.charAt(0).toUpperCase() + areaComparativa.slice(1),
              data: [totalPres, totalReal]
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });

      renderTopDeviations();
    }

    function configurarToggleTipo() {
      const toggle = document.getElementById("toggleTipo");
      const selectMonth = document.getElementById("selectMonth");

      toggle.querySelectorAll("span").forEach(span => {
        span.addEventListener("click", () => {
          const nuevo = span.getAttribute("data-tipo");
          if (nuevo === tipoActual) return;
          tipoActual = nuevo;

          // activar visualmente el toggle
          toggle.querySelectorAll("span").forEach(s => s.classList.remove("active"));
          span.classList.add("active");

          // mostrar/ocultar dropdown de mes
          if (tipoActual === "mensual") {
            selectMonth.style.display = "";
          } else {
            selectMonth.style.display = "none";
          }

          renderSecciones();
          renderTotales();
          renderComparativo();
        });
      });

      // estado inicial (mensual → mostrar dropdown)
      selectMonth.style.display = "";
    }

    function configurarChips() {
      const chips = document.getElementById("chipsArea");
      chips.querySelectorAll(".chip").forEach(chip => {
        chip.addEventListener("click", () => {
          const area = chip.getAttribute("data-area");
          if (area === areaComparativa) return;
          areaComparativa = area;

          chips.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
          chip.classList.add("active");

          renderComparativo();
        });
      });
    }

    let areaModal = "ingresos";

    function abrirModal(area) {
      areaModal = area;
      const modal = document.getElementById("modal");
      const title = document.getElementById("modalTitle");
      const sel = document.getElementById("modalCategoria");
      const montoInput = document.getElementById("modalMonto");
      const nota = document.getElementById("modalNota");

      title.textContent = "Añadir a " + areaModal;
      sel.innerHTML = "";
      opcionesCategorias[areaModal].forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        sel.appendChild(opt);
      });

      montoInput.value = "";
      nota.value = "";

      modal.classList.add("open");
    }

    function cerrarModal() {
      document.getElementById("modal").classList.remove("open");
    }

    function configurarModal() {
      document.querySelectorAll(".add-btn-small").forEach(btn => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          const area = btn.getAttribute("data-area");
          abrirModal(area);
        });
      });

      document.getElementById("btnCancel").addEventListener("click", cerrarModal);

      document.getElementById("btnSave").addEventListener("click", () => {
        const sel = document.getElementById("modalCategoria");
        const montoInput = document.getElementById("modalMonto");
        const valor = parseFloat(montoInput.value || "0");
        if (!valor) {
          cerrarModal();
          return;
        }

        const f = factorTipo();
        const montoMensual = valor / f; // se guarda siempre en base mensual

        demoData.presupuesto[areaModal].push({
          categoria: sel.value,
          monto: montoMensual
        });

        cerrarModal();
        renderSecciones();
        renderTotales();
        renderComparativo();
      });

      document.getElementById("modal").addEventListener("click", (e) => {
        if (e.target.id === "modal") cerrarModal();
      });
    }

    function configurarAcordeones() {
      document.querySelectorAll(".accordion-header").forEach(header => {
        header.addEventListener("click", () => {
          const section = header.closest(".section");
          section.classList.toggle("collapsed");
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      configurarToggleTipo();
      configurarChips();
      configurarModal();
      configurarAcordeones();
      renderSecciones();
      renderTotales();
      renderComparativo();
    });
  </script>
</body>
</html>
